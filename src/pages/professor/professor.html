<ion-header>
  <ion-navbar color="anhembiColor" hideBackButton>
    <!-- Título -->
    <ion-title>Gerenciamento de Atividades Complementares</ion-title>
    <ion-buttons end>
      <button ion-button icon-only title="Sair" (click)="logoutProf()">
        <ion-icon name="power"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content padding class="planFundo">
  <ion-grid>
    <div class="info">
      <ion-grid>
        <!--Menu Professor-->
        <ion-row *ngFor="let item of professor|async" justify-content-center>
          <ion-col col-xl-3 col-sm-12>
            <ion-item class="ionItemUsuario" text-center>
              <ion-icon name="person" color="black" class="tamIcon"></ion-icon>
              <p class="usuario">{{item.nome}}</p>
            </ion-item>
          </ion-col>
        </ion-row>

        <ion-row justify-content-end>
          <ion-col col-xl-3 col-sm-12>
            <ion-item>
              <ion-select (ionChange)="buscaAlunoCurso()" placeholder="Curso:" okText="Buscar">
                <ion-option (ionSelect)="optCurso('CCO')">Ciências da Computação</ion-option>
                <ion-option (ionSelect)="optCurso('SI')">Sistemas da Informação</ion-option>
              </ion-select>
            </ion-item>
          </ion-col>
        </ion-row>

        <ion-row>
          <!-- DIV ALUNOS -->
          <ion-col col-xl-4 col-sm-12>
            <ion-item color="anhembiColor">
              <ion-row justify-content-between>
                <ion-col col-lg-4>
                  <p class="text">RA</p>
                </ion-col>
                <ion-col col-lg-8>
                  <p class="text">ALUNO</p>
                </ion-col>
              </ion-row>
            </ion-item>
            <!-- LISTAGEM DE ALUNOS -->
            <ion-list>
              <ion-item *ngFor="let alunos of aluno | async" (click)="getListaCertificado(alunos.ra)">
                <ion-row>
                  <ion-col col-lg-4>
                    <p class="text">{{alunos.ra}}</p>
                  </ion-col>
                  <ion-col col-lg-8>
                    <p class="text">{{alunos.nome}}</p>
                  </ion-col>
                </ion-row>
              </ion-item>
            </ion-list>
          </ion-col>

          <!-- DIV CERTIFICADOS -->
          <ion-col col-xl-4 col-sm-12>
            <ion-item color="anhembiColor">
              <ion-row justify-content-between>
                <ion-col col-lg-12>
                  <p class="text" text-center>CERTIFICADOS ENVIADOS</p>
                </ion-col>
              </ion-row>
            </ion-item>
            <!--LISTAGEM DE CERTIFICADOS ENVIADOS-->
            <ion-list>
              <ion-item *ngFor="let certificados of certificado | async "
                (click)="buscaCertificadoExp(certificados.key)">
                <ion-row>

                  <div *ngIf="certificados.status == 'pendente', then histPendente"></div>
                  <ng-template #histPendente>
                    <ion-col col-lg-6>
                      <p class="text">{{certificados.categoria}}</p>
                    </ion-col>
                    <ion-col col-lg-6>
                      <ion-icon text-right title="pendente" ios="ios-alert" md="md-alert"></ion-icon>
                    </ion-col>
                  </ng-template>

                  <div *ngIf="certificados.status == 'validado', then histValidado"></div>
                  <ng-template #histValidado>
                    <ion-col col-lg-6>
                      <p class="text">{{certificados.categoria}}</p>
                    </ion-col>
                    <ion-col col-lg-6>
                      <ion-icon title="validado" ios="ios-checkmark-circle" md="md-checkmark-circle">
                      </ion-icon>
                    </ion-col>
                  </ng-template>

                  <div *ngIf="certificados.status == 'recusado', then histRecusado"></div>
                  <ng-template #histRecusado>
                    <ion-col col-lg-6>
                      <p class="text">{{certificados.categoria}}</p>
                    </ion-col>
                    <ion-col col-lg-6>
                      <ion-icon title="recusado" ios="ios-close-circle" md="md-close-circle"></ion-icon>
                    </ion-col>
                  </ng-template>

                </ion-row>
              </ion-item>
            </ion-list>
          </ion-col>

          <!-- DIV MANIPULACAO DE CERTIFICADOS -->
          <ion-col col-xl-4 col-sm-12>
            <ion-item color="anhembiColor">
              <ion-row justify-content-between>
                <ion-col col-lg-12>
                  <p class="text" text-center>VALIDAÇÃO</p>
                </ion-col>
              </ion-row>
            </ion-item>
            <ion-list>
              <ion-item *ngFor="let certificado of certVal | async ">
                  <ion-row >
                      <div *ngIf="certificado.status == 'pendente', then maniPendente"></div>
                      <ng-template #maniPendente>
                        <ion-col col-lg-3>
                            <a href="{{certificado.url}}" target="blank">
                              <button>
                                  <img src="../assets/pdf.ico" class="tamIconPDF"/><p class="textFile">Visualizar</p>
                              </button>
                            </a>
                        </ion-col>
                        <ion-col col-lg-3>
                          <ion-item>
                              <ion-input aria-required="horas" type="number" min="1" max="40" [(ngModel)]="horas" placeholder="Horas:">
                                </ion-input>

                          </ion-item>
                        </ion-col>
                        <ion-col col-lg-3>
                          <button ion-button color="anhembiColor" (click)="validaCert(horas,certificado.key, certificado.ra)">Validar</button>
                        </ion-col>
                        <ion-col col-lg-3>
                          <button ion-button (click)="recusaCert(certificado.key)">Recusar</button>
                        </ion-col>
                      </ng-template>

                      <div *ngIf="certificado.status == 'validado', then infoValidado"></div>
                      <ng-template #infoValidado>
                        <ion-col col-lg-6>
                          <p class="text">{{certificado.horasValidadas}} horas validadas</p>
                        </ion-col>
                        <ion-col col-lg-6>
                          <p class="text">Avaliado em: {{certificado.dataValid}}</p>
                        </ion-col>
                      </ng-template>

                      <div *ngIf="certificado.status == 'recusado', then infoRecusado"></div>
                      <ng-template #infoRecusado>
                        <ion-col col-lg-6>
                          <p class="text">Certificado recusado</p>
                        </ion-col>
                        <ion-col col-lg-6>
                          <p class="text">Avaliado em: {{certificado.dataValid}}</p>
                        </ion-col>
                      </ng-template>

                    </ion-row>
              </ion-item>
            </ion-list>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>
  </ion-grid>
</ion-content>
